<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - æ¡‚ç”µè‡ªä¿®ç³»ç»Ÿ</title>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus@2.4.2/dist/index.css">
    <script src="https://cdn.jsdelivr.net/npm/element-plus@2.4.2/dist/index.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@element-plus/icons-vue@2.3.1/dist/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; margin: 0; padding: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        [v-cloak] { display: none !important; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 30px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08); overflow: hidden; display: flex; width: 1000px; max-width: 90vw; height: 600px; }
        .left-panel { background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 60px; display: flex; flex-direction: column; justify-content: space-between; position: relative; overflow: hidden; width: 45%; }
        .right-panel { padding: 60px; width: 55%; display: flex; flex-direction: column; justify-content: center; }
        .circle-bg { position: absolute; border-radius: 50%; background: rgba(255,255,255,0.1); }
        .custom-input .el-input__wrapper { box-shadow: none !important; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 8px 16px; transition: all 0.3s; }
        .custom-input .el-input__wrapper.is-focus { border-color: #10b981; background: #fff; box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1) !important; }
        .custom-btn { width: 100%; border-radius: 12px !important; padding: 24px 0 !important; font-size: 16px !important; font-weight: bold !important; letter-spacing: 1px; transition: all 0.3s !important; }
        .custom-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3) !important; }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none !important; margin: 0; }
        input[type='number'] { -moz-appearance: textfield; }
    </style>
</head>
<body>
<div id="app" v-cloak>
    <div class="glass-card">
        <div class="left-panel hidden md:flex">
            <div class="circle-bg w-64 h-64 -top-20 -left-20"></div>
            <div class="circle-bg w-96 h-96 -bottom-32 -right-32 opacity-50"></div>

            <div class="relative z-10 flex-grow flex flex-col justify-center">
                <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mb-8 shadow-lg text-emerald-600 cursor-pointer hover:scale-105 transition-transform" @click="goMobile" title="åˆ‡æ¢è‡³ç§»åŠ¨ç«¯ç™»å½•">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-10 h-10">
                        <path d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72l5 2.73 5-2.73v3.72z"/>
                    </svg>
                </div>

                <h1 class="text-4xl font-black mb-4 leading-tight">æ¡‚ç”µè‡ªä¿®å®¤<br>æ™ºèƒ½äº’è”ç³»ç»Ÿ</h1>
                <p class="text-emerald-50 text-lg font-medium tracking-widest mb-8">
                    æ­£å¾·åšå­¦ &nbsp;&nbsp; ç¬ƒè¡Œè‡´æ–°
                </p>
            </div>
        </div>

        <div class="right-panel">
            <div class="mb-6 text-center md:text-left">
                <h2 class="text-3xl font-black text-slate-800 mb-2">{{ isLogin ? 'æ¬¢è¿å›æ¥ ğŸ‘‹' : 'æ³¨å†Œè´¦å· ğŸš€' }}</h2>
                <p class="text-slate-500 text-sm">{{ isLogin ? 'è¯·è¾“å…¥æ‚¨çš„å­¦å·å’Œå¯†ç ç™»å½•ç³»ç»Ÿ' : 'è¯·å¡«å†™æ‚¨çš„çœŸå®ä¿¡æ¯å®Œæˆæ³¨å†Œ' }}</p>
            </div>

            <el-form :model="form" @submit.prevent="handleAuth" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-700 mb-2 uppercase">Student ID</label>
                    <el-input v-model="form.username" placeholder="è¯·è¾“å…¥å­¦å·" class="custom-input" prefix-icon="User" size="large"></el-input>
                </div>

                <div v-if="!isLogin" class="animate-fade-in flex gap-4">
                    <div class="flex-1">
                        <label class="block text-xs font-bold text-slate-700 mb-2 uppercase">Real Name</label>
                        <el-input v-model="form.realName" placeholder="çœŸå®å§“å" class="custom-input" prefix-icon="Postcard" size="large"></el-input>
                    </div>
                    <div class="flex-1">
                        <label class="block text-xs font-bold text-slate-700 mb-2 uppercase">Phone</label>
                        <el-input v-model="form.phone" type="tel" placeholder="11ä½æ‰‹æœºå·ç " class="custom-input" prefix-icon="Iphone" size="large"></el-input>
                    </div>
                </div>

                <div v-if="!isLogin" class="animate-fade-in">
                    <label class="block text-xs font-bold text-slate-700 mb-2 uppercase">Verify Code</label>
                    <div class="flex gap-3 w-full">
                        <el-input v-model="form.verifyCode" type="tel" placeholder="6ä½éªŒè¯ç " prefix-icon="Key" size="large" class="custom-input flex-grow"></el-input>
                        <el-button type="primary" plain native-type="button" size="large" class="!rounded-xl" :disabled="regCountdown > 0" @click="sendRegMockCode" style="width: 110px;">
                            {{ regCountdown > 0 ? regCountdown + 's åé‡å‘' : 'è·å–éªŒè¯ç ' }}
                        </el-button>
                    </div>
                </div>

                <div>
                    <div class="flex justify-between items-end mb-2">
                        <label class="block text-xs font-bold text-slate-700 uppercase">Password</label>
                        <el-button v-if="isLogin" link native-type="button" type="primary" class="!text-xs !text-emerald-600 font-bold" @click="forgotDialogVisible = true">ä¿®æ”¹å¯†ç ï¼Ÿ</el-button>
                    </div>
                    <el-input v-model="form.password" type="password" show-password placeholder="è¯·è¾“å…¥å¯†ç " class="custom-input" prefix-icon="Lock" size="large"></el-input>
                </div>

                <el-button type="primary" native-type="submit" color="#10b981" class="custom-btn mt-6" :loading="loading">
                    {{ isLogin ? 'ç«‹ å³ ç™» å½•' : 'ç¡® è®¤ æ³¨ å†Œ' }}
                </el-button>
            </el-form>

            <div class="mt-6 text-center text-sm text-slate-500 font-medium">
                {{ isLogin ? 'è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ' : 'å·²ç»æœ‰è´¦å·äº†ï¼Ÿ' }}
                <span class="text-emerald-600 font-bold cursor-pointer hover:underline" @click="toggleMode">
                        {{ isLogin ? 'ç«‹å³æ³¨å†Œ' : 'è¿”å›ç™»å½•' }}
                    </span>
            </div>
        </div>
    </div>

    <el-dialog v-model="forgotDialogVisible" title="æ‰¾å›å¯†ç " width="400px" align-center append-to-body>
        <el-form :model="forgotForm" @submit.prevent="submitResetPassword" label-position="top">
            <div class="mb-6 text-xs text-slate-600 bg-slate-50 p-4 rounded-xl border border-slate-100 flex gap-3">
                <el-icon class="text-emerald-500 text-lg flex-shrink-0"><component :is="'ChatDotSquare'"></component></el-icon>
                <div>è¯·è¿›è¡Œæ‰‹æœºéªŒè¯ç å®‰å…¨æ ¸éªŒä»¥é‡ç½®æ‚¨çš„å¯†ç ã€‚</div>
            </div>

            <el-form-item label="æ‚¨çš„å­¦å·">
                <el-input v-model="forgotForm.username" placeholder="è¯·è¾“å…¥æ³¨å†Œæ—¶çš„å­¦å·" prefix-icon="User" size="large" class="custom-input"></el-input>
            </el-form-item>

            <el-form-item label="ç»‘å®šçš„æ‰‹æœºå·ç ">
                <el-input v-model="forgotForm.phone" type="tel" placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·ç " prefix-icon="Iphone" size="large" class="custom-input"></el-input>
            </el-form-item>

            <el-form-item label="çŸ­ä¿¡éªŒè¯ç ">
                <div class="flex gap-3 w-full">
                    <el-input v-model="forgotForm.verifyCode" type="tel" placeholder="6ä½éªŒè¯ç " prefix-icon="Key" size="large" class="custom-input flex-grow"></el-input>
                    <el-button type="primary" plain native-type="button" size="large" class="!rounded-xl" :disabled="countdown > 0" @click="sendMockCode" style="width: 110px;">
                        {{ countdown > 0 ? countdown + 's åé‡å‘' : 'è·å–éªŒè¯ç ' }}
                    </el-button>
                </div>
            </el-form-item>

            <el-form-item label="è®¾ç½®æ–°å¯†ç ">
                <el-input v-model="forgotForm.newPassword" type="password" show-password placeholder="è¯·è¾“å…¥æ–°çš„å¯†ç " prefix-icon="Lock" size="large" class="custom-input"></el-input>
            </el-form-item>

            <div class="flex justify-end gap-3 mt-4">
                <el-button @click="forgotDialogVisible = false" native-type="button" size="large" class="!rounded-xl">å–æ¶ˆ</el-button>
                <el-button type="primary" native-type="submit" color="#059669" :loading="resetLoading" size="large" class="!rounded-xl font-bold">ç¡®è®¤é‡ç½®</el-button>
            </div>
        </el-form>
    </el-dialog>
</div>

<script>
    const { createApp, ref } = Vue;
    axios.defaults.baseURL = 'http://localhost:8080';

    const app = createApp({
        setup() {
            const isLogin = ref(true);
            const loading = ref(false);
            const form = ref({ username: '', password: '', realName: '', phone: '', verifyCode: '' });
            const regCountdown = ref(0);

            const forgotDialogVisible = ref(false);
            const resetLoading = ref(false);
            const forgotForm = ref({ username: '', phone: '', verifyCode: '', newPassword: '' });
            const countdown = ref(0);

            const toggleMode = () => {
                isLogin.value = !isLogin.value;
                form.value = { username: '', password: '', realName: '', phone: '', verifyCode: '' };
                regCountdown.value = 0;
            };

            const sendRegMockCode = () => {
                if (!form.value.phone || form.value.phone.length !== 11) {
                    return ElementPlus.ElMessage.warning('è¯·è¾“å…¥æ­£ç¡®çš„11ä½æ‰‹æœºå·ç ');
                }
                ElementPlus.ElMessage({
                    message: 'çŸ­ä¿¡éªŒè¯ç å·²å‘é€ï¼Œæµ‹è¯•ç¯å¢ƒè¯·ä½¿ç”¨ï¼š123456',
                    type: 'success',
                    duration: 5000
                });
                regCountdown.value = 60;
                const timer = setInterval(() => {
                    regCountdown.value--;
                    if (regCountdown.value <= 0) clearInterval(timer);
                }, 1000);
            };

            const handleAuth = async () => {
                if (!form.value.username || !form.value.password) {
                    return ElementPlus.ElMessage.warning('è¯·å¡«å†™å­¦å·å’Œå¯†ç ');
                }

                let payload = {
                    username: form.value.username,
                    password: form.value.password
                };

                if (!isLogin.value) {
                    if(!form.value.realName) return ElementPlus.ElMessage.warning('æ³¨å†Œéœ€è¦å¡«å†™çœŸå®å§“å');
                    if(!form.value.phone || form.value.phone.length !== 11) return ElementPlus.ElMessage.warning('è¯·è¾“å…¥æ­£ç¡®çš„11ä½æ‰‹æœºå·ç ');
                    if(!form.value.verifyCode) return ElementPlus.ElMessage.warning('è¯·è¾“å…¥çŸ­ä¿¡éªŒè¯ç ');
                    if(form.value.verifyCode !== '123456') return ElementPlus.ElMessage.error('çŸ­ä¿¡éªŒè¯ç é”™è¯¯');

                    payload.realName = form.value.realName;
                    payload.phone = form.value.phone;
                }

                loading.value = true;
                try {
                    if (isLogin.value) {
                        const res = await axios.post('/api/user/login', payload);
                        ElementPlus.ElMessage.success('ç™»å½•æˆåŠŸ');
                        localStorage.setItem('user', JSON.stringify(res.data));

                        setTimeout(() => {
                            window.location.replace('index.html');
                        }, 300);
                    } else {
                        await axios.post('/api/user/register', payload);
                        ElementPlus.ElMessage.success('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•');
                        toggleMode();
                    }
                } catch (e) {
                    ElementPlus.ElMessage.error(e.response?.data || 'æ“ä½œå¤±è´¥');
                } finally {
                    loading.value = false;
                }
            };

            const sendMockCode = () => {
                if (!forgotForm.value.phone || forgotForm.value.phone.length !== 11) {
                    return ElementPlus.ElMessage.warning('è¯·è¾“å…¥æ­£ç¡®çš„11ä½æ‰‹æœºå·ç ');
                }
                ElementPlus.ElMessage({
                    message: 'çŸ­ä¿¡éªŒè¯ç å·²å‘é€ï¼Œæµ‹è¯•ç¯å¢ƒè¯·ä½¿ç”¨ï¼š123456',
                    type: 'success',
                    duration: 5000
                });
                countdown.value = 60;
                const timer = setInterval(() => {
                    countdown.value--;
                    if (countdown.value <= 0) clearInterval(timer);
                }, 1000);
            };

            const submitResetPassword = async () => {
                if (!forgotForm.value.username || !forgotForm.value.phone || !forgotForm.value.verifyCode || !forgotForm.value.newPassword) {
                    return ElementPlus.ElMessage.warning('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
                }
                resetLoading.value = true;
                try {
                    const res = await axios.post('/api/user/reset-password', forgotForm.value);
                    ElementPlus.ElMessage.success(res.data);
                    forgotDialogVisible.value = false;
                    forgotForm.value = { username: '', phone: '', verifyCode: '', newPassword: '' };
                    countdown.value = 0;
                } catch (e) {
                    ElementPlus.ElMessage.error(e.response?.data || 'é‡ç½®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä¿¡æ¯');
                } finally {
                    resetLoading.value = false;
                }
            };

            // å»ç§»åŠ¨ç«¯é¡µé¢çš„æ–¹æ³•
            const goMobile = () => {
                window.location.href = 'mobile-login.html';
            };

            return {
                isLogin, loading, form, toggleMode, handleAuth,
                regCountdown, sendRegMockCode,
                forgotDialogVisible, resetLoading, forgotForm, submitResetPassword,
                countdown, sendMockCode, goMobile
            };
        }
    });

    for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
        app.component(key, component);
    }
    app.use(ElementPlus);
    app.mount('#app');
</script>
</body>
</html>