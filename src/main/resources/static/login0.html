<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - æ¡‚ç”µè‡ªä¿®ç³»ç»Ÿ</title>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus@2.4.2/dist/index.css">
    <script src="https://cdn.jsdelivr.net/npm/element-plus@2.4.2/dist/index.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@element-plus/icons-vue@2.3.1/dist/index.iife.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.2/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; margin: 0; padding: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        [v-cloak] { display: none !important; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 30px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08); overflow: hidden; display: flex; width: 1000px; max-width: 90vw; height: 600px; }
        .left-panel { background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 60px; display: flex; flex-direction: column; justify-content: space-between; position: relative; overflow: hidden; width: 45%; }
        .right-panel { padding: 60px; width: 55%; display: flex; flex-direction: column; justify-content: center; }
        .circle-bg { position: absolute; border-radius: 50%; background: rgba(255,255,255,0.1); }
        .custom-input .el-input__wrapper { box-shadow: none !important; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 8px 16px; transition: all 0.3s; }
        .custom-input .el-input__wrapper.is-focus { border-color: #10b981; background: #fff; box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1) !important; }
        .custom-btn { width: 100%; border-radius: 12px !important; padding: 24px 0 !important; font-size: 16px !important; font-weight: bold !important; letter-spacing: 1px; transition: all 0.3s !important; }
        .custom-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3) !important; }
    </style>
</head>
<body>
<div id="app" v-cloak>
    <div class="glass-card">
        <div class="left-panel hidden md:flex">
            <div class="circle-bg w-64 h-64 -top-20 -left-20"></div>
            <div class="circle-bg w-96 h-96 -bottom-32 -right-32 opacity-50"></div>

            <div class="relative z-10 flex-grow flex flex-col justify-center">
                <div class="w-16 h-16 bg-white rounded-2xl flex items-center justify-center mb-8 shadow-lg">
                    <el-icon class="text-3xl text-emerald-600"><component :is="'School'"></component></el-icon>
                </div>
                <h1 class="text-4xl font-black mb-4 leading-tight">æ¡‚ç”µè‡ªä¿®å®¤<br>æ™ºèƒ½äº’è”ç³»ç»Ÿ</h1>

                <p class="text-emerald-50 text-lg font-medium tracking-widest mb-8">
                    æ­£å¾·åšå­¦ &nbsp; ç¬ƒè¡Œè‡´æ–°
                </p>
            </div>
        </div>

        <div class="right-panel">
            <div class="mb-10 text-center md:text-left">
                <h2 class="text-3xl font-black text-slate-800 mb-2">{{ isLogin ? 'æ¬¢è¿å›æ¥ ğŸ‘‹' : 'æ³¨å†Œè´¦å· ğŸš€' }}</h2>
                <p class="text-slate-500 text-sm">{{ isLogin ? 'è¯·è¾“å…¥æ‚¨çš„å­¦å·å’Œå¯†ç ç™»å½•ç³»ç»Ÿ' : 'è¯·å¡«å†™æ‚¨çš„çœŸå®ä¿¡æ¯å®Œæˆæ³¨å†Œ' }}</p>
            </div>

            <el-form :model="form" @keyup.enter="handleAuth" class="space-y-6">
                <div>
                    <label class="block text-xs font-bold text-slate-700 mb-2 uppercase">Student ID</label>
                    <el-input v-model="form.username" placeholder="è¯·è¾“å…¥å­¦å·" class="custom-input" prefix-icon="User" size="large"></el-input>
                </div>

                <div v-if="!isLogin" class="animate-fade-in">
                    <label class="block text-xs font-bold text-slate-700 mb-2 uppercase">Real Name</label>
                    <el-input v-model="form.realName" placeholder="è¯·è¾“å…¥çœŸå®å§“å" class="custom-input" prefix-icon="Postcard" size="large"></el-input>
                </div>

                <div>
                    <div class="flex justify-between items-end mb-2">
                        <label class="block text-xs font-bold text-slate-700 uppercase">Password</label>
                        <el-button v-if="isLogin" link type="primary" class="!text-xs !text-emerald-600 font-bold" @click="forgotDialogVisible = true">å¿˜è®°å¯†ç ï¼Ÿ</el-button>
                    </div>
                    <el-input v-model="form.password" type="password" show-password placeholder="è¯·è¾“å…¥å¯†ç " class="custom-input" prefix-icon="Lock" size="large"></el-input>
                </div>

                <el-button type="primary" color="#10b981" class="custom-btn mt-4" @click="handleAuth" :loading="loading">
                    {{ isLogin ? 'ç«‹ å³ ç™» å½•' : 'ç¡® è®¤ æ³¨ å†Œ' }}
                </el-button>
            </el-form>

            <div class="mt-8 text-center text-sm text-slate-500 font-medium">
                {{ isLogin ? 'è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ' : 'å·²ç»æœ‰è´¦å·äº†ï¼Ÿ' }}
                <span class="text-emerald-600 font-bold cursor-pointer hover:underline" @click="toggleMode">
                        {{ isLogin ? 'ç«‹å³æ³¨å†Œ' : 'è¿”å›ç™»å½•' }}
                    </span>
            </div>
        </div>
    </div>

    <el-dialog v-model="forgotDialogVisible" title="æ‰¾å›å¯†ç " width="400px" align-center append-to-body>
        <el-form :model="forgotForm" label-position="top">
            <div class="mb-6 text-xs text-slate-600 bg-emerald-50 p-4 rounded-xl border border-emerald-100 flex gap-3">
                <el-icon class="text-emerald-500 text-lg flex-shrink-0"><component :is="'Warning'"></component></el-icon>
                <div>ä¸ºä¿éšœè´¦å·å®‰å…¨ï¼Œéœ€æ ¸éªŒæ‚¨çš„ <b>å­¦å·</b> ä¸ç³»ç»Ÿç»‘å®šçš„ <b>çœŸå®å§“å</b> æ˜¯å¦ä¸€è‡´ã€‚</div>
            </div>

            <el-form-item label="æ‚¨çš„å­¦å·">
                <el-input v-model="forgotForm.username" placeholder="è¯·è¾“å…¥æ³¨å†Œæ—¶çš„å­¦å·" prefix-icon="User" size="large" class="custom-input"></el-input>
            </el-form-item>
            <el-form-item label="çœŸå®å§“å (èº«ä»½æ ¸éªŒ)">
                <el-input v-model="forgotForm.realName" placeholder="è¯·è¾“å…¥ç»‘å®šçš„çœŸå®å§“å" prefix-icon="Postcard" size="large" class="custom-input"></el-input>
            </el-form-item>
            <el-form-item label="è®¾ç½®æ–°å¯†ç ">
                <el-input v-model="forgotForm.newPassword" type="password" show-password placeholder="è¯·è¾“å…¥æ–°çš„å¯†ç " prefix-icon="Lock" size="large" class="custom-input"></el-input>
            </el-form-item>
        </el-form>
        <template #footer>
            <div class="flex justify-end gap-3">
                <el-button @click="forgotDialogVisible = false" size="large" class="!rounded-xl">å–æ¶ˆ</el-button>
                <el-button type="primary" color="#059669" @click="submitResetPassword" :loading="resetLoading" size="large" class="!rounded-xl font-bold">ç¡®è®¤é‡ç½®</el-button>
            </div>
        </template>
    </el-dialog>
</div>

<script>
    const { createApp, ref } = Vue;
    axios.defaults.baseURL = 'http://localhost:8080';

    const app = createApp({
        setup() {
            const isLogin = ref(true);
            const loading = ref(false);
            const form = ref({ username: '', password: '', realName: '' });

            const forgotDialogVisible = ref(false);
            const resetLoading = ref(false);
            const forgotForm = ref({ username: '', realName: '', newPassword: '' });

            const toggleMode = () => {
                isLogin.value = !isLogin.value;
                form.value = { username: '', password: '', realName: '' };
            };

            const handleAuth = async () => {
                if (!form.value.username || !form.value.password) {
                    return ElementPlus.ElMessage.warning('è¯·å¡«å†™å­¦å·å’Œå¯†ç ');
                }
                if (!isLogin.value && !form.value.realName) {
                    return ElementPlus.ElMessage.warning('æ³¨å†Œéœ€è¦å¡«å†™çœŸå®å§“å');
                }

                loading.value = true;
                try {
                    if (isLogin.value) {
                        const res = await axios.post('/api/user/login', form.value);
                        ElementPlus.ElMessage.success('ç™»å½•æˆåŠŸ');
                        localStorage.setItem('user', JSON.stringify(res.data));
                        window.location.href = 'index.html';
                    } else {
                        await axios.post('/api/user/register', form.value);
                        ElementPlus.ElMessage.success('æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•');
                        toggleMode();
                    }
                } catch (e) {
                    ElementPlus.ElMessage.error(e.response?.data || 'æ“ä½œå¤±è´¥');
                } finally {
                    loading.value = false;
                }
            };

            const submitResetPassword = async () => {
                if (!forgotForm.value.username || !forgotForm.value.realName || !forgotForm.value.newPassword) {
                    return ElementPlus.ElMessage.warning('è¯·å¡«å†™å®Œæ•´çš„æ ¸éªŒä¿¡æ¯ä¸æ–°å¯†ç ');
                }
                resetLoading.value = true;
                try {
                    const res = await axios.post('/api/user/reset-password', forgotForm.value);
                    ElementPlus.ElMessage.success(res.data);
                    forgotDialogVisible.value = false;
                    forgotForm.value = { username: '', realName: '', newPassword: '' };
                } catch (e) {
                    ElementPlus.ElMessage.error(e.response?.data || 'é‡ç½®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ ¸éªŒä¿¡æ¯');
                } finally {
                    resetLoading.value = false;
                }
            };

            return {
                isLogin, loading, form, toggleMode, handleAuth,
                forgotDialogVisible, resetLoading, forgotForm, submitResetPassword
            };
        }
    });

    for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
        app.component(key, component);
    }

    app.use(ElementPlus);
    app.mount('#app');
</script>
</body>
</html>